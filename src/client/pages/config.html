<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Config
    </title>

    <link rel="stylesheet" href="styles/config.css">
</head>
<body>

    <div class = 'type-card-cnt'>
        
        <img src="images/icon.png" alt="" class = 'card-img'>

        <p class = 'card-type-p'>Start Meeting Follow-Up</p>
        
        <div class = 'card-desc-p-cnt'>
            <p class = 'card-desc-p'>> Improved meeting results</p>
            <p class = 'card-desc-p'>> Continuous increase in meeting efficiency</p>
            <p class = 'card-desc-p'>> Strengthening the team culture</p>
            <p class = 'card-desc-p'>> More commitment to implementation</p>    
        </div>
        

        <button class = 'start-card-btn' id = 'start-btn'>
            Start Meeting Follow-Up
        </button>
    </div>
    
</body>
</html>

<script 
src="https://res.cdn.office.net/teams-js/2.10.1/js/MicrosoftTeams.min.js"
integrity="sha384-Tc1x2xjzm4vRqLV4l416qPm+i7t8ujpxrioZEjRCNP7g/gQNDW41TB1SpVkQxowY"
crossorigin="anonymous"
></script>

<script src="scripts/teams/constants.js"></script>

<script type = 'module'>

    await microsoftTeams.app.initialize()
    console.log('HELLO WORLD')

    function setTheme(theme) {
        if (theme) {        
            document.body.className =
                'theme-' + (theme === 'default' ? 'light' : theme);
        }
    }

    microsoftTeams.getContext(function (context) {
        if (context && context.theme) {
            setTheme(context.theme);
        }
    });
    
    microsoftTeams.registerOnThemeChangeHandler(function (theme) {
        setTheme(theme);
    });

    const setAdmin = (admin) => {
        localStorage.setItem('admin', admin)
    }

    const registerConfig = async(url) => {
        microsoftTeams.pages.config.setValidityState(true)

        microsoftTeams.pages.config.registerOnSaveHandler(async(saveEvent) => {
            const configPromise = microsoftTeams.pages.config.setConfig({
                websiteUrl:url,
                contentUrl:url,
                entityId:url
            })

            configPromise.then((result) => {
                saveEvent.notifySuccess()
            }).catch(error => {
                console.log(error)
                saveEvent.notifyFailure('Fail occured', error)
            })

            const context = await microsoftTeams.app.getContext();

            const email = context.user.userPrincipalName

            console.log("admin's email: ",email)

            setAdmin(email)
        })
    }


    const page = () => {
        const configPageUrl = `${srcUrl}/config`

        registerConfig(configPageUrl)
    }

    const callQck = () => {
        
        const url = `http://qck.app/ms-teams/create-questionnaire/meeting-follow-up/[teamsname]/`
        
        registerConfig(url)
    }

    document.getElementById('start-btn').addEventListener('click', page)
</script>